"use strict";(self["webpackChunkiview_admin_plus"]=self["webpackChunkiview_admin_plus"]||[]).push([[492],{5492:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var o=a(73396),s=a(87139);const n=(0,o._)("span",{class:"ivu-pl-8"},"前端日志",-1),i=(0,o.Uk)("查看");function l(e,t,a,l,r,c){const g=(0,o.up)("Avatar"),h=(0,o.up)("Button"),u=(0,o.up)("Tooltip"),m=(0,o.up)("Tag"),p=(0,o.up)("Table"),d=(0,o.up)("Page"),w=(0,o.up)("Card");return(0,o.wg)(),(0,o.j4)(w,{shadow:""},{title:(0,o.w5)((()=>[(0,o.Wm)(g,{icon:"md-locate",size:"small",style:{color:"#2f54eb",background:"#f0f5ff"}}),n])),extra:(0,o.w5)((()=>[(0,o.Wm)(u,{transfer:"",content:"导出日志",placement:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{type:"dashed",icon:"ios-cloud-download-outline",onClick:c.exportLog,style:{"margin-right":"10px"}},null,8,["onClick"])])),_:1}),(0,o.Wm)(u,{transfer:"",content:"清空日志",placement:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{type:"dashed",icon:"md-trash",onClick:e.cleanLog},null,8,["onClick"])])),_:1})])),default:(0,o.w5)((()=>[(0,o._)("div",{class:(0,s.C_)(`${e.$config.cssPrefix}table-no-border`)},[(0,o.Wm)(p,{ref:"table",columns:r.columns,data:r.tableData,onOnSortChange:c.changeSort},{type:(0,o.w5)((({row:e})=>[(0,o.Wm)(m,{color:"error"===e.type?"red":"blue"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.type),1)])),_:2},1032,["color"])])),page:(0,o.w5)((({row:e})=>[(0,o.Uk)((0,s.zw)(e.meta.url),1)])),request:(0,o.w5)((({row:e})=>[(0,o.Uk)((0,s.zw)(e.meta.apiURL),1)])),more:(0,o.w5)((({row:e})=>[(0,o.Wm)(h,{size:"small",ghost:"",type:"primary",onClick:t=>c.viewLog(e)},{default:(0,o.w5)((()=>[i])),_:2},1032,["onClick"])])),_:1},8,["columns","data","onOnSortChange"]),(0,o.Wm)(d,{"show-total":"","show-sizer":"","show-elevator":"",class:"ivu-text-center",total:c.logList.length,onOnChange:c.changePage,onOnPageSizeChange:c.changePageSize},null,8,["total","onOnChange","onOnPageSizeChange"])],2)])),_:1})}var r=a(20065),c=a(28762),g={name:"SystemLog",data(){return{columns:[{title:"序号",align:"center",width:65,render:(e,{row:t,col:a,index:o})=>e("span",(this.currentPage-1)*this.pageSize+o+1)},{title:"时间",key:"time",width:180,sortable:!0},{title:"类型",key:"type",width:100,slot:"type"},{title:"信息",key:"message"},{title:"触发页面",slot:"page"},{title:"请求地址",slot:"request"},{title:"详细信息",align:"center",width:100,slot:"more"}],tableData:[],currentPage:1,pageSize:10,timeOrder:"desc"}},computed:{logList(){return this.$store.state.log.logList}},watch:{logList(){this.changePage(this.currentPage)}},created(){this.changePage()},methods:{...(0,r.OI)([c.KM]),exportLog(){this.logList.length?this.$refs.table.exportCsv({filename:"错误日志.csv"}):this.$Message.info("没有日志或异常")},viewLog(e){this.$Message.info("按F12打开控制台查看完整日志"),this.$console.capsule(this.$config.titleSuffix,"完整日志内容"),console.group("完整日志"),console.log("message: ",e.message),console.log("source: ",e.source),console.log("time: ",e.time),console.log("type: ",e.type),console.log("meta: ",e.meta),console.groupEnd()},changePage(e){this.currentPage=e||1;const t=(this.currentPage-1)*this.pageSize,a=this.logList.map((e=>({...e,timestamp:new Date(e.time)}))).sort(((e,t)=>"asc"===this.timeOrder?e.timestamp-t.timestamp:t.timestamp-e.timestamp));this.tableData=a.slice(t,t+this.pageSize)},changePageSize(e){this.pageSize=e,this.changePage(this.currentPage)},changeSort(e){this.timeOrder=e.order,this.changePage(this.currentPage)}}},h=a(40089);const u=(0,h.Z)(g,[["render",l]]);var m=u}}]);